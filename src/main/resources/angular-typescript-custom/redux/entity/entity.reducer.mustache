import { Action, createReducer, on } from '@ngrx/store';
import { {{entityName}}Actions as Actions } from './{{#lambda.KebabCustom}}{{{entityName}}}{{/lambda.KebabCustom}}.actions';
import State from './{{#lambda.KebabCustom}}{{{entityName}}}{{/lambda.KebabCustom}}.state';
import {Pagination} from '@api/{{#lambda.KebabCustom}}{{apiName}}{{/lambda.KebabCustom}}/models/common/pagination.model';
{{#imports}}
import { {{#lambda.RemoveDTO}}{{classname}}{{/lambda.RemoveDTO}} } from '@api/{{#lambda.KebabCustom}}{{apiName}}{{/lambda.KebabCustom}}/models/{{#lambda.KebabCustom}}{{classname}}{{/lambda.KebabCustom}}.model';
{{/imports}}
{{#operations}}
{{#operation}}
import { {{{operationIdOriginal}}}Request } from '@api/{{#lambda.KebabCustom}}{{apiName}}{{/lambda.KebabCustom}}/services/{{#lambda.KebabCustom}}{{classname}}{{/lambda.KebabCustom}}.service'; 
{{/operation}}
{{/operations}}

import { FormGroup } from '@angular/forms';
import { NullableFormControl } from '@api/{{#lambda.KebabCustom}}{{apiName}}{{/lambda.KebabCustom}}/models/common/nullable-form-control.model';

function createFormInitialState<T extends Record<string, any>>() {
  return new FormGroup<NullableFormControl<T>>({} as T);
}

const initialState = {
    {{#operations}}
    {{#operation}}
    {{{operationIdOriginal}}}: {
        hasError: false,
        isLoaded: false,
        errors: Array.of<ValidationError>(),
        {{#lambda.Skip}}data: { {{#isArray}}currentPage: 0,totalPages: 0,pageSize: 0,totalCount: 0, items: []{{/isArray}} } as {{#lambda.Result}}{{{returnType}}}{{/lambda.Result}},{{/lambda.Skip}}
        form: createFormInitialState<{{operationIdOriginal}}Request>()
    },
    {{/operation}}
    {{/operations}}
} as State;

const reducer = createReducer<State>(
  initialState,
  {{#operations}}
  {{#operation}}
    // @ts-ignore
    on(Actions.{{{operationIdOriginal}}}Init, state => ({...state, {{{operationIdOriginal}}}:{hasError: false,isLoaded: false{{#lambda.Skip}}, data: { {{#isArray}}currentPage: 0,totalPages: 0,pageSize: 0,totalCount: 0, items: []{{/isArray}} } as {{#lambda.Result}}{{{returnType}}}{{/lambda.Result}} {{/lambda.Skip}}}})),
    {{#lambda.Skip}}// @ts-ignore{{/lambda.Skip}}
    {{#lambda.Skip}}on(Actions.{{{operationIdOriginal}}}SetData, (state,{data}) => ({ ...state, {{{operationIdOriginal}}}: {data: data, isLoaded: true, hasError: false }})),{{/lambda.Skip}}
    // @ts-ignore
    on(Actions.{{{operationIdOriginal}}}SetError, (state,{form}) => ({ ...state, {{{operationIdOriginal}}}: {isLoaded: false, hasError: true{{#lambda.Skip}},form: form, data: { {{#isArray}}currentPage: 0,totalPages: 0,pageSize: 0,totalCount: 0, items: []{{/isArray}} } as {{#lambda.Result}}{{{returnType}}}{{/lambda.Result}} {{/lambda.Skip}} }})),
    // @ts-ignore
    on(Actions.{{{operationIdOriginal}}}Success, (state) => ({ ...state, {{{operationIdOriginal}}}: {data: state?.{{{operationIdOriginal}}}?.data, isLoaded: true, hasError: false }})),
  {{/operation}}
  {{/operations}}
);

export default function currentReducer(
  state: State,
  action: Action
) {
  return reducer(state, action);
}